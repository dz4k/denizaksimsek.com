---
layout: ./base.eta
---

<nav class="container">
    <p><a href="/<%= lang %>">&larr; <%= intl["Home"][lang] %> </a></p>
</nav>
<article class="container h-entry">
    <header>
        <% if ("title" in it) { %>
            <h1 class="p-name"><%= it.title %></h1>
        <% } %>
        <p class="list-of-links">
            <% repeat(tags, (tag, loop) => { %>
                <a href="/tag/<%= tag %>"><data class="p-category" value="<% tag %>">
                    <%= intl[tag + " (tag)"]?.[lang] ?? tag %></data></a><%~ loop.sep(" &middot; ") %>
            <% }) %>

            <time class="dt-published" datetime="<%= comp.date({ date, iso: true }) %>">
                <%~ comp.date({ date, time: true, lang }) %></time>
            
            <%_ if ("last modified" in it) { _%>
                , <em><%= intl["last modified"][it.lang] %></em>
                <time class="dt-last-modified" datetime="<%= comp.date({ date: it["last modified"], iso: true }) %>">
                    <%= comp.date({ date: it["last modified"], time: true, lang }) %></time> 
            <% } %>
        </p>
        <% if ("alt" in it) { %>
            <p>
                🌐
                <% repeat(Object.entries(it.alt), ([language, href], loop) => { %>
                    <a 
                        rel="alternate"
                        lang="<%= language %>"
                        hreflang="<%= language %>"
                        href="<%= href %>">
                        <%= intl[language][language] %></a>
                <% }) %>
            </p>
        <% } %>


        <% for (const prop of ["repost of", "like of"]) { %>
            <% if (prop in it) { %>
                <p>
                    <strong><%= intl[prop][lang] %></strong>
                    <a class="u-<%= prop.replace(" ", "-") %>" href="<%= it[prop].url %>">
                        <%= it[prop].name %>
                    </a>
                </p>
            <% } %>
        <% } %>

        </dl>        
        <% if ("..." in it) { %>
            <p class="italic"><%~ it["..."] %></p>
        <% } %>
    </header>

    <% if ("bookmark of" in it) { %>
        <missing-card class="crowded" onclick="this.querySelector('a').click()">
            <p>
                &rarr;
                <a class="u-bookmark-of" href="<%= it["bookmark of"].url %>">
                    <%= it["bookmark of"].name %>
                </a>
            </p>
        </missing-card>
    <% } %>
    
    <div class="e-content">
        <%~ it.content %>
    </div>

    <% const backlinks = search.pages(`internalLinks*='${url}'`) %>
    <% if (backlinks.length > 0) { %>
        <footer class="missing-card">
            <div>
                <h3 class="block-label">Backlinks</h3>
                <%~ comp.entryList({
                    entries: backlinks,
                    dates: false,
                    lang
                }) %>
            </div>
        </footer>
    <% } %>
    
    <% if (webmentions.has(url) || "syndication" in it) { %>
        <footer class="missing-card">
            <% if ("syndication" in it) { %>
                <p>
                    <strong class="block-label"><%= intl["Elsewhere"][lang] %>:</strong> 
                    <% repeat(Object.keys(it.syndication), (syn, loop) => { %>
                        <a rel="syndication" href="<%= it.syndication[syn] %>">
                            <%= syn %></a><%= loop.sep(", ") %>
                    <% }) %>
                </p>
            <% } %>

            <% let allWms, wms; %>
            <% if (allWms = webmentions.get(url)) { %>
                    <% for (const prop of ["repost-of", "like-of"]) { %>
                        <% if (wms = allWms.get(prop)) { %>
                            <p class="list-of-links">
                                <strong class="block-label"><%= intl[prop + " (reflexive)"][lang] %>:</strong>
                                <% repeat(wms, (wm, loop) => { %>
                                    <a href="<%= wm.url %>"><%= wm.author.name %></a><%= loop.sep(", ") %>
                                <% }) %>
                            </p>
                        <% } %>
                    <% }%>

                    <% if (wms = allWms.get("in-reply-to")) { %>
                        <h3><%= intl["Replies"][lang] %></h3>
                        <% repeat(wms, (wm, loop) => { %>
                            <article class="h-entry margin-block">
                                <% if (wm.author) { %>
                                    <b><a class="p-author h-card" href="<%= wm.author.url %>">
                                        <%= wm.author.name %></a></b> &middot;
                                <% } %>
                                <a href="<%= wm.url %>">
                                    <%= filters.date(wm.published ?? wm["wm-received"], "M_DATETIME", it.lang) %></a>
                                <div class="e-content">
                                    <%= wm.content.text %>
                                </div>
                            </article>
                        <% }) %>
                    <% } %>
            <% } %>
        </footer>
    <% } %>
</article>
